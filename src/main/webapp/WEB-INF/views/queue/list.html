<!DOCTYPE html>
<html ng-app="qwait" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.springframework.org/security/tags">
  <head>
    <title>Queue List &mdash; QWait</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link rel="shortcut icon" id="favicon" href="../../../icons/favicon.ico" th:href="@{/icons/favicon.ico}"/>
    <link rel="apple-touch-icon" sizes="144x144" href="../../../icons/apple-touch-icon-144x144.png"
          th:href="@{/icons/apple-touch-icon-144x144.png}"/>
    <link rel="apple-touch-icon" sizes="114x114" href="../../../icons/apple-touch-icon-114x114.png"
          th:href="@{/icons/apple-touch-icon-114x114.png}"/>
    <link rel="apple-touch-icon" sizes="72x72" href="../../../icons/apple-touch-icon-72x72.png"
          th:href="@{/icons/apple-touch-icon-72x72.png}"/>
    <link rel="apple-touch-icon" href="../../../icons/apple-touch-icon.png" th:href="@{/icons/apple-touch-icon.png}"/>

    <link rel="stylesheet" href="../../../../../../target/webapp/css/style.css" th:href="@{/css/style.css}"/>

    <script src="../../js-vendor/angular.js" th:src="@{/js-vendor/angular.js}"></script>
    <script src="../../../../js/qwait.js" th:src="@{/js/qwait.js}"></script>
    <script type="text/javascript" th:inline="javascript">
      /* <![CDATA[ */
      qwait.controller('QueueListCtrl', ['$scope', function ($scope) {
        var queueBaseUrl = /*[[@{/queue/}]]*/ '';

        /*[- */
        $scope.queues = [
          {name: "Queue 1", id: 1, positions: []},
          {name: "Queue 2", id: 2, positions: []}
        ];
        /* -]*/
        /*[+
         $scope.queues = JSON.parse([[${queuesJson}]]);
         +]*/

        for (var i = 0; i < $scope.queues.length; i++) {
          var q = $scope.queues[i];
          q.removeUrl = queueBaseUrl + q.id + '/remove';
          q.closeUrl = queueBaseUrl + q.id + '/close';
          q.openUrl = queueBaseUrl + q.id + '/open';
          q.lockUrl = queueBaseUrl + q.id + '/lock';
          q.unlockUrl = queueBaseUrl + q.id + '/unlock';
        }
      }]);
      /* ]]> */
    </script>
  </head>

  <body>
    <div th:replace="fragment/layout :: topbar"></div>
    <div class="row">
      <div class="large-12 columns" ng-controller="QueueListCtrl">
        <h1 class="no-bot-margin text-center">Queue List</h1>
        <div ng-hide="queues.length">
          <p class="text-center">There are currently no queues.</p>
        </div>
        <div class="row">
          <div class="large-9 large-centered columns">
            <div class="row">
              <table class="large-12 columns">
                <div class="row">
                  <div class="large-4 columns">
                    <form sec:authorize="hasRole('super_admin')" th:action="@{/queue/create}" th:method="POST">
                      <label>
                        Add a new queue
                        <div class="row collapse">
                          <div class="small-9 columns">
                            <input id="queue-name" name="name" type="text" placeholder="New queue name"/>
                          </div>
                          <div class="small-3 columns">
                            <button type="submit" class="button postfix">Add</button>
                          </div>
                        </div>
                      </label>
                    </form>
                  </div>
                  <label ng-show="queues.length" class="large-4 columns pull-right">
                    <div class="add-queue-margin show-for-large-up" sec:authorize="hasRole('super_admin')"></div> 
                    <input ng-model="search.name" class="search" name="search" type="text" placeholder="Find queues"/>  
                  </label>
                </div>
                <thead ng-show="queues.length">
                  <tr>
                    <th>Name</th>
                    <th width="48">
                      <img th:src="@{/icons/queue-man.png}"
                            src="../../../icons/queue-man.png" height="17" width="17"/>
                    </th>
                    <th sec:authorize="hasRole('admin')" width="1">Locked</th>
                    <th sec:authorize="hasRole('admin')" width="1">Active</th>
                    <th sec:authorize="hasRole('admin')" width="1">&nbsp;</th>
                    <th sec:authorize="hasRole('admin')" width="1">&nbsp;</th>
                    <th sec:authorize="hasRole('super_admin')" width="1">&nbsp;</th>
                  </tr>
                </thead>
                <tbody ng-show="queues.length">
                  <!-- Filter only by name -->
                  <tr ng-repeat="queue in queues | filter:search | orderBy:['-positions.length','name']">
                    <td><a href="show.html" th:href="@{/queue/{{queue.id}}}">{{queue.name}}</a></td>
                    <td>{{queue.positions.length}}</td>
                    <td sec:authorize="hasRole('admin')">{{queue.locked}}</td>
                    <td sec:authorize="hasRole('admin')">{{queue.active}}</td>
                    <td sec:authorize="hasRole('admin')">
                      <form th:attr="ng-show='queue.locked'" th:action="'{{queue.unlockUrl}}'" th:method="POST">
                        <button type="submit" class="button tiny no-bot-margin">Unlock</button>
                      </form>
                      <form th:attr="ng-hide='queue.locked'" th:action="'{{queue.lockUrl}}'" th:method="POST">
                        <button type="submit" class="button tiny no-bot-margin">Lock</button>
                      </form>
                    </td>
                    <td sec:authorize="hasRole('admin')">
                      <form th:attr="ng-show='queue.active'" th:action="'{{queue.closeUrl}}'" th:method="POST">
                        <button type="submit" class="button tiny no-bot-margin">Close</button>
                      </form>
                      <form th:attr="ng-hide='queue.active'" th:action="'{{queue.openUrl}}'" th:method="POST">
                        <button type="submit" class="button tiny no-bot-margin">Open</button>
                      </form>
                    </td>
                    <td sec:authorize="hasRole('super_admin')">
                      <form th:action="'{{queue.removeUrl}}'" th:method="POST">
                        <button type="submit" class="button tiny no-bot-margin">Remove</button>
                      </form>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="../../../js-vendor/jquery.js" th:src="@{/js-vendor/jquery.js}"></script>
    <script src="../../../js-vendor/foundation.js" th:src="@{/js-vendor/foundation.js}"></script>
    <script src="../../../js-vendor/foundation.topbar.js" th:src="@{/js-vendor/foundation.topbar.js}"></script>
    <script>$(document).foundation();</script>
  </body>
</html>
